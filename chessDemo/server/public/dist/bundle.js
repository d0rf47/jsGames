(()=>{"use strict";function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var i=function(){function i(e,o,n,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t(this,"type",""),t(this,"color",""),t(this,"position",""),t(this,"index",{}),t(this,"icon",""),t(this,"moved",!1),t(this,"alive",!0),this.position=o,this.type=e,this.color=n,this.index=s,this.initPiece()}var o,n;return o=i,(n=[{key:"initPiece",value:function(){var e=document.createElement("i"),t=document.getElementById("".concat(this.position));switch(e.classList.add(this.color,"gamepiece"),e.setAttribute("data-position",this.position),e.setAttribute("data-type",this.type),e.setAttribute("data-team",this.color),this.icon=e,e.setAttribute("data-object",window.btoa(JSON.stringify(this))),this.type){case"pawn":e.classList.add("fas","fa-chess-pawn");break;case"bishop":e.classList.add("fas","fa-chess-bishop");break;case"rook":e.classList.add("fas","fa-chess-rook");break;case"knight":e.classList.add("fas","fa-chess-knight");break;case"queen":e.classList.add("fas","fa-chess-queen");break;case"king":e.classList.add("fas","fa-chess-king")}this.icon=e,t.append(this.icon)}}])&&e(o.prototype,n),i}();function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function n(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var r=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"tiles",void 0),s(this,"lightPieces",[]),s(this,"darkPieces",[]),this.tiles=(t=Array(8),function(e){if(Array.isArray(e))return o(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){return Array(8).fill(void 0)}))}var t,r;return t=e,(r=[{key:"initBoard",value:function(){for(var e=document.getElementsByClassName("tile"),t=0,i=0,o=0;o<64;o++)e[o].setAttribute("data-index","".concat(t,",").concat(i)),this.tiles[t][i]={location:e[o].attributes.id.nodeValue,occupied:!1,element:e[o]},i++,7!==o&&15!==o&&23!==o&&31!==o&&39!==o&&47!==o&&55!==o||(t++,i=0);this.initlightPieces(),this.initdarkPieces(),console.log(this.tiles)}},{key:"initlightPieces",value:function(){for(var e=97,t=1;t<=8;t++){var o=2+String.fromCharCode(e),n=new i("pawn",o,"light",{row:6,col:t-1});this.lightPieces.push(n),this.tiles[1][t-1].occupied=!0,e++}this.lightPieces.push(new i("rook","1a","light",{row:7,col:0})),this.tiles[0][0].occupied=!0,this.lightPieces.push(new i("rook","1h","light",{row:7,col:7})),this.tiles[0][7].occupied=!0,this.lightPieces.push(new i("knight","1b","light",{row:7,col:1})),this.tiles[0][1].occupied=!0,this.lightPieces.push(new i("knight","1g","light",{row:7,col:6})),this.tiles[0][6].occupied=!0,this.lightPieces.push(new i("bishop","1c","light",{row:7,col:2})),this.tiles[0][2].occupied=!0,this.lightPieces.push(new i("bishop","1f","light",{row:7,col:5})),this.tiles[0][5].occupied=!0,this.lightPieces.push(new i("queen","1d","light",{row:7,col:3})),this.tiles[0][3].occupied=!0,this.lightPieces.push(new i("king","1e","light",{row:7,col:4})),this.tiles[0][4].occupied=!0}},{key:"initdarkPieces",value:function(){for(var e=97,t=1;t<=8;t++){var o=7+String.fromCharCode(e),n=new i("pawn",o,"dark",{row:1,col:t-1});this.darkPieces.push(n),this.tiles[6][t-1].occupied=!0,e++}this.darkPieces.push(new i("rook","8a","dark",{row:0,col:0})),this.tiles[7][0].occupied=!0,this.darkPieces.push(new i("rook","8h","dark",{row:0,col:7})),this.tiles[7][7].occupied=!0,this.darkPieces.push(new i("knight","8b","dark",{row:0,col:1})),this.tiles[7][1].occupied=!0,this.darkPieces.push(new i("knight","8g","dark",{row:0,col:6})),this.tiles[7][6].occupied=!0,this.darkPieces.push(new i("bishop","8c","dark",{row:0,col:2})),this.tiles[7][2].occupied=!0,this.darkPieces.push(new i("bishop","8f","dark",{row:0,col:5})),this.tiles[7][5].occupied=!0,this.darkPieces.push(new i("queen","8d","dark",{row:0,col:3})),this.tiles[7][3].occupied=!0,this.darkPieces.push(new i("king","8e","dark",{row:0,col:4})),this.tiles[7][4].occupied=!0}},{key:"locateTile",value:function(e){for(var t=0,i=0,o=0;o<64;o++){if(this.tiles[t][i].location===e)return{tile:this.tiles[t][i],index:{row:t,col:i}};i++,7!==o&&15!==o&&23!==o&&31!==o&&39!==o&&47!==o&&55!==o||(t++,i=0)}}}])&&n(t.prototype,r),e}();function c(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,c=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return r=e.done,e},e:function(e){c=!0,s=e},f:function(){try{r||null==i.return||i.return()}finally{if(c)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function l(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function h(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}(new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"board",void 0),h(this,"lightTurn",!0),h(this,"inCheck",!1),h(this,"inCheckMate",!1),h(this,"inStaleMate",!1),h(this,"pieceToMove",void 0),h(this,"lastPiece",void 0),h(this,"potentialMoves",[]),h(this,"opposingMove",[]),h(this,"currentTeam",{color:"light",pieces:[],inCheck:!1})}var t,i;return t=e,(i=[{key:"initGame",value:function(){this.board=new r,this.board.initBoard(),this.addEventListeners(),this.currentTeam.pieces=this.board.lightPieces}},{key:"checkPotentialMoves",value:function(e){switch(e.type){case"pawn":return this.checkPawnMove(e);case"rook":return this.checkRookMove(e);case"bishop":return this.checkBishopMove(e);case"knight":return this.checkKnightMove(e);case"queen":return this.checkBishopMove(e).concat(this.checkRookMove(e));case"king":return this.checkKingMove(e)}}},{key:"checkPawnMove",value:function(e){var t=this.board.locateTile(e.position),i=t.index.row,o=t.index.col,n=[],s=1;return"light"===e.color&&(s=-1),this.board.tiles[i+s][o].occupied||((!e.moved&&!this.board.tiles[i+s+s][o].occupied||!e.moved&&this.board.tiles[i+s+s][o].occupied&&this.board.tiles[i+s+s][o].element.children[0].getAttribute("data-team")!==e.color)&&n.push({row:i+s+s,col:o}),n.push({row:i+s,col:o})),o-1>=0&&i+s<8&&i+s>=0&&this.canMove(i+s,o-1,e)&&this.isOccupied(i+s,o-1)&&n.push({row:i+s,col:o-1}),o+1<8&&i+s<8&&i+s>=0&&this.canMove(i+s,o+1,e)&&this.isOccupied(i+s,o+1)&&n.push({row:t.index.row+s,col:o+1}),n}},{key:"checkRookMove",value:function(e){for(var t=this.board.locateTile(e.position),i=t.index.row,o=t.index.col,n=[],s=1;!(!(s<=8&&i-s>=0)||this.isOccupied(i-s,o)&&this.board.tiles[i-s][o].element.children[0].getAttribute("data-team")===e.color||this.canMove(i-s,o,e)&&(n.push({row:i-s,col:o}),this.isOccupied(i-s,o)));s++);for(var r=1;!(!(r<=8&&i+r<=7)||this.isOccupied(i+r,o)&&this.board.tiles[i+r][o].element.children[0].getAttribute("data-team")===e.color||this.canMove(i+r,o,e)&&(n.push({row:i+r,col:o}),this.isOccupied(i+r,o)));r++);for(var c=1;!(!(c<=8&&o-c>=0)||this.isOccupied(i,o-c)&&this.board.tiles[i][o-c].element.children[0].getAttribute("data-team")===e.color||this.canMove(i,o-c,e)&&(n.push({row:i,col:o-c}),this.isOccupied(i,o-c)));c++);for(var a=1;!(!(a<=8&&o+a<=7)||this.isOccupied(i,o+a)&&this.board.tiles[i][o+a].element.children[0].getAttribute("data-team")===e.color||this.canMove(i,o+a,e)&&(n.push({row:i,col:o+a}),this.isOccupied(i,o+a)));a++);return n}},{key:"checkBishopMove",value:function(e){for(var t=this.board.locateTile(e.position),i=t.index.row,o=t.index.col,n=[],s=1;!(!(s<=8&&i-s>=0&&o-s>=0)||this.isOccupied(i-s,o-s)&&this.board.tiles[i-s][o-s].element.children[0].getAttribute("data-team")===e.color||this.canMove(i-s,o-s,e)&&(n.push({row:i-s,col:o-s}),this.isOccupied(i-s,o-s)));s++);for(var r=1;!(!(r<=8&&i-r>=0&&o+r<=7)||this.isOccupied(i-r,o+r)&&this.board.tiles[i-r][o+r].element.children[0].getAttribute("data-team")===e.color||this.canMove(i-r,o+r,e)&&(n.push({row:i-r,col:o+r}),this.isOccupied(i-r,o+r)));r++);for(var c=1;!(!(c<=8&&i+c<=7&&o-c>=0)||this.isOccupied(i+c,o-c)&&this.board.tiles[i+c][o-c].element.children[0].getAttribute("data-team")===e.color||this.canMove(i+c,o-c,e)&&(n.push({row:i+c,col:o-c}),this.isOccupied(i+c,o-c)));c++);for(var a=1;!(!(a<=8&&i+a<=7&&o+a<=7)||this.isOccupied(i+a,o+a)&&this.board.tiles[i+a][o+a].element.children[0].getAttribute("data-team")===e.color||this.canMove(i+a,o+a,e)&&(n.push({row:i+a,col:o+a}),this.isOccupied(i+a,o+a)));a++);return n}},{key:"checkKnightMove",value:function(e){var t=this.board.locateTile(e.position),i=t.index.row,o=t.index.col,n=[],s=2,r=1;return i-s>=0&&(o-r>=0&&this.canMove(i-s,o-r,e)&&n.push({row:i-s,col:o-r}),o+r<=7&&this.canMove(i-s,o+r,e)&&n.push({row:i-s,col:o+r})),i+s<=8&&(o-r>=0&&this.canMove(i+s,o-r,e)&&n.push({row:i+s,col:o-r}),o+r<=7&&this.canMove(i+s,o+r,e)&&n.push({row:i+s,col:o+r})),s=1,o-(r=2)>=0&&(i-s>=0&&this.canMove(i-s,o-r,e)&&n.push({row:i-s,col:o-r}),i+s<=7&&this.canMove(i+s,o-r,e)&&n.push({row:i+s,col:o-r})),o+r<=7&&(i-s>=0&&this.canMove(i-s,o+r,e)&&n.push({row:i-s,col:o+r}),i+s<=7&&this.canMove(i+s,o+r,e)&&n.push({row:i+s,col:o+r})),n}},{key:"checkKingMove",value:function(e){var t=this.board.locateTile(e.position),i=t.index.row,o=t.index.col,n=[];return this.isInBound(i-1)&&this.canMove(i-1,o,e)&&n.push({row:i-1,col:o}),this.isInBound(i+1)&&this.canMove(i+1,o,e)&&n.push({row:i+1,col:o}),this.isInBound(o-1)&&this.canMove(i,o-1,e)&&n.push({row:i,col:o-1}),this.isInBound(o+1)&&this.canMove(i,o+1,e)&&n.push({row:i,col:o+1}),this.isInBound(i-1)&&this.isInBound(o-1)&&this.canMove(i-1,o-1,e)&&n.push({row:i-1,col:o-1}),this.isInBound(i-1)&&this.isInBound(o+1)&&this.canMove(i-1,o+1,e)&&n.push({row:i-1,col:o+1}),this.isInBound(i+1)&&this.isInBound(o-1)&&this.canMove(i+1,o-1,e)&&n.push({row:i+1,col:o-1}),this.isInBound(i+1)&&this.isInBound(o+1)&&this.canMove(i+1,o+1,e)&&n.push({row:i+1,col:o+1}),n}},{key:"inCurrCheck",value:function(){var e=this,t=this.board.lightPieces.filter((function(e){return"king"===e.type}))[0];"dark"===this.currentTeam.color?(t=this.board.darkPieces.filter((function(e){return"king"===e.type}))[0],this.board.lightPieces.forEach((function(i){e.checkPotentialMoves(i);var o,n=c(e.potentialMoves);try{for(n.s();!(o=n.n()).done;){var s=o.value;if(s.row===t.row&&s.col===t.col){e.inCheck=!0;break}}}catch(e){n.e(e)}finally{n.f()}}))):this.board.darkPieces.forEach((function(i){e.checkPotentialMoves(i);var o,n=c(e.potentialMoves);try{for(n.s();!(o=n.n()).done;){var s=o.value;if(s.row===t.row&&s.col===t.col){e.inCheck=!0;break}}}catch(e){n.e(e)}finally{n.f()}})),this.potentialMoves=[]}},{key:"isOpponentCheck",value:function(e){var t=this,i=this.checkPotentialMoves(e),o=this.board.lightPieces.filter((function(e){return"king"===e.type}))[0];"light"===e.color&&(o=this.board.darkPieces.filter((function(e){return"king"===e.type}))[0]),console.log("opposing king",o),i.forEach((function(e){e.row===o.index.row&&e.col===o.index.col&&(t.inCheck=!0)})),this.inCheck&&o.icon.classList.add("check","checkPulse")}},{key:"removeCheck",value:function(){this.currentTeam.pieces.filter((function(e){return"king"===e.type}))[0].icon.classList.remove("check","checkPulse"),this.inCheck=!1}},{key:"displayPotentialMoves",value:function(e){var t=this,i=[],o=JSON.parse(window.atob(e.getAttribute("data-object")));if(this.validTurn(o)){if(i=this.checkPotentialMoves(o),this.currentTeam.inCheck){var n=this.checkPotentialMoves(this.lastPiece);if("king"===o.type)n.forEach((function(e){for(var t=0;t<i.length;t++)e.col===i[t].col&&e.row===i[t].row&&(i.splice(t,1),t--)}));else{for(var s=[],r=!1,a=0;a<i.length&&!r;a++){var l,h=c(n);try{for(h.s();!(l=h.n()).done;){var u=l.value;if(i[a].col===this.lastPiece.index.col&&i[a].row===this.lastPiece.index.row&&s.push(i[a]),u.col===i[a].col&&u.row===i[a].row&&this.inPathOfKing(i[a],o)&&(console.log("found"),r=!0,s.push(i[a])),r)break}}catch(e){h.e(e)}finally{h.f()}}i=s}}this.potentialMoves=i,this.potentialMoves.forEach((function(e){t.board.tiles[e.row][e.col].element.classList.add("overlay-effect")}))}}},{key:"selectPieceToMove",value:function(e){this.pieceToMove=e.target;var t=JSON.parse(window.atob(this.pieceToMove.getAttribute("data-object")));this.validTurn(t)}},{key:"initMove",value:function(e){var t=parseInt(e.target.getAttribute("data-index").toString()[0]),i=parseInt(e.target.getAttribute("data-index").toString().substring(2)),o=JSON.parse(window.atob(this.pieceToMove.getAttribute("data-object")));this.validTurn(o)&&(this.potentialMoves.filter((function(e){return e.row===t&&e.col===i})).length<1||(this.updatePositions(e.target,o),e.target.appendChild(this.pieceToMove),this.isOpponentCheck(o),this.swapCurrentTeam()))}},{key:"updatePositions",value:function(e,t){console.log("updating pos"),console.log(e,t);for(var i=0,o=0,n=0;n<64;n++){if(this.board.tiles[i][o].location===t.position&&(this.board.tiles[i][o].occupied=!1),this.board.tiles[i][o].location===e.id&&(this.board.tiles[i][o].occupied=!0,e.firstChild)){var s=JSON.parse(window.atob(e.firstChild.getAttribute("data-object")));console.log("peice to REMOVE",s),e.removeChild(e.childNodes[0])}o++,7!==n&&15!==n&&23!==n&&31!==n&&39!==n&&47!==n&&55!==n||(i++,o=0)}t.moved=!0;var r=e.getAttribute("data-index");t.index={row:parseInt(r[0]),col:parseInt(r[2])},t.position=e.id,this.pieceToMove.setAttribute("data-object",window.btoa(JSON.stringify(t))),this.lastPiece=t,this.inCheck&&this.removeCheck()}},{key:"addEventListeners",value:function(){for(var e=this,t=document.getElementsByClassName("gamepiece"),i=document.getElementsByClassName("tile"),o=0;o<i.length;o++)i[o].addEventListener("click",(function(t){e.initMove(t)}));for(var n=function(i){["mousedown","mouseup","click"].forEach((function(o){"mousedown"===o?t[i].addEventListener(o,(function(t){e.displayPotentialMoves(t.target)})):"mouseup"===o?t[i].addEventListener(o,(function(e){for(var t=document.getElementsByClassName("overlay-effect"),i=t.length-1;i>=0;i--)t[i].classList.remove("overlay-effect")})):"click"===o&&t[i].addEventListener(o,(function(t){e.selectPieceToMove(t)}))}))},s=0;s<t.length;s++)n(s)}},{key:"validTurn",value:function(e){return!(this.lightTurn&&"light"!==e.color||!this.lightTurn&&"dark"!==e.color)}},{key:"isOccupied",value:function(e,t){return this.board.tiles[e][t].occupied}},{key:"canMove",value:function(e,t,i){return!(this.isOccupied(e,t)&&(!this.isOccupied(e,t)||this.board.tiles[e][t].element.children[0].getAttribute("data-team")===i.color))}},{key:"isInBound",value:function(e){return e<=7&&e>=0}},{key:"swapCurrentTeam",value:function(){this.inCurrCheck(this.c),"light"===this.currentTeam.color?(this.currentTeam.color="dark",this.currentTeam.pieces=this.board.darkPieces):(this.currentTeam.color="light",this.currentTeam.pieces=this.board.lightPieces),this.currentTeam.inCheck=this.inCheck,this.lightTurn=!this.lightTurn,this.potentialMoves=[]}},{key:"inPathOfKing",value:function(e,t){console.log("last piece",this.lastPiece),console.log("my move",e),console.log(this.board.tiles[e.row][e.col]),this.board.tiles[e.row][e.col].occupied=!0;var i=document.getElementById(t.position).firstChild.cloneNode();i.style.display="none";var o=this.board.tiles[e.row][e.col].element;o.appendChild(i);var n,s=c(this.checkPotentialMoves(this.lastPiece));try{for(s.s();!(n=s.n()).done;){var r=n.value;if(this.board.tiles[r.row][r.col].element.firstChild){var a=this.board.tiles[r.row][r.col].element.firstChild;if(console.log(a),"king"===a.getAttribute("data-type"))return!1}}}catch(e){s.e(e)}finally{s.f()}return o.removeChild(o.childNodes[0]),this.board.tiles[e.row][e.col].occupied=!1,!0}}])&&l(t.prototype,i),e}())).initGame()})();